var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
import asyncScriptLoader from './asyncScriptLoader';
let didIncludeOnce = false;
const DEFAULT_SD = 'https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.4.1/bundles/webcomponents-sd.js';
const DEFAULT_CE = 'https://cdn.jsdelivr.net/npm/@webcomponents/webcomponentsjs@2.4.1/bundles/webcomponents-ce.js';
const DEFAULT_AD = 'https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/2.4.1/custom-elements-es5-adapter.js';
const includePolyfills = (options, plugins) => __awaiter(void 0, void 0, void 0, function* () {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
    if (didIncludeOnce) {
        return;
    }
    const scriptsList = [];
    let useSD = '';
    let useCE = '';
    let useAD = '';
    const polyfillLoaderPlugin = plugins === null || plugins === void 0 ? void 0 : plugins.find((plugin) => plugin.name === 'polyfill-loader');
    const disableSD = ((_a = polyfillLoaderPlugin === null || polyfillLoaderPlugin === void 0 ? void 0 : polyfillLoaderPlugin.options) === null || _a === void 0 ? void 0 : _a.use.sd) === false;
    const disableCE = ((_b = polyfillLoaderPlugin === null || polyfillLoaderPlugin === void 0 ? void 0 : polyfillLoaderPlugin.options) === null || _b === void 0 ? void 0 : _b.use.ce) === false;
    const disableAD = ((_c = polyfillLoaderPlugin === null || polyfillLoaderPlugin === void 0 ? void 0 : polyfillLoaderPlugin.options) === null || _c === void 0 ? void 0 : _c.use.adapter) === false;
    if ((_d = polyfillLoaderPlugin === null || polyfillLoaderPlugin === void 0 ? void 0 : polyfillLoaderPlugin.options) === null || _d === void 0 ? void 0 : _d.use.sd) {
        useSD = typeof ((_e = polyfillLoaderPlugin.options) === null || _e === void 0 ? void 0 : _e.use.sd) === 'string'
            ? (_f = polyfillLoaderPlugin.options) === null || _f === void 0 ? void 0 : _f.use.sd : DEFAULT_SD;
    }
    if ((_g = polyfillLoaderPlugin === null || polyfillLoaderPlugin === void 0 ? void 0 : polyfillLoaderPlugin.options) === null || _g === void 0 ? void 0 : _g.use.ce) {
        useCE = typeof ((_h = polyfillLoaderPlugin.options) === null || _h === void 0 ? void 0 : _h.use.ce) === 'string'
            ? (_j = polyfillLoaderPlugin.options) === null || _j === void 0 ? void 0 : _j.use.ce : DEFAULT_CE;
    }
    if ((_k = polyfillLoaderPlugin === null || polyfillLoaderPlugin === void 0 ? void 0 : polyfillLoaderPlugin.options) === null || _k === void 0 ? void 0 : _k.use.adapter) {
        useAD = typeof ((_l = polyfillLoaderPlugin.options) === null || _l === void 0 ? void 0 : _l.use.adapter) === 'string'
            ? polyfillLoaderPlugin.options.use.adapter
            : DEFAULT_AD;
    }
    if (options.usesShadow && !disableSD) {
        scriptsList.push(asyncScriptLoader(useSD || DEFAULT_SD, 'wcPolyfillsLoaded'));
    }
    if (!disableCE) {
        scriptsList.push(asyncScriptLoader(useCE || DEFAULT_CE, 'wcPolyfillsLoaded'));
    }
    if (!disableAD) {
        scriptsList.push(asyncScriptLoader(useAD || DEFAULT_AD, 'wcPolyfillsLoaded'));
    }
    try {
        yield Promise.all(scriptsList);
        didIncludeOnce = true;
    }
    catch (error) {
        console.error(error);
    }
});
export default includePolyfills;
